/* ruote-fluo-all-2.3.1.min.js | MIT license: http://github.com/jmettraux/ruote-fluo/LICENSE.txt */
var RuoteFluoEditor=function(){var p={add_child_expression:"add a child expression",cut_expression:"cut expression",moveup_expression:"move expression up",movedown_expression:"move expression down",paste_expression:"paste expression here"};var b=function(){function z(C,D,E){var B=document.createElement("a");B.callback=E;B.className="rfe_button "+C;B.setAttribute("href","");B.setAttribute("title",D);B.setAttribute("onclick","this.callback(); return false;");return B}function A(E){var B=0;var D=document.createElement("span");D.className="rfe_buttons";D.style.opacity=B;var C=f(E);E.onmouseover=function(){D.style.opacity=1;if(C.onOver){C.onOver(s(E.parentNode))}};E.onmouseout=function(){D.style.opacity=B;if(C.onOver){C.onOver(null)}};D.appendChild(z("rfe_add",RuoteFluoEditor.TEXTS.add_child_expression,function(){RuoteFluoEditor.addExpression(E.parentNode,["---",{},[]])}));if(E.parentNode.parentNode!=C){D.appendChild(z("rfe_cut",RuoteFluoEditor.TEXTS.cut_expression,function(){RuoteFluoEditor.removeExpression(E.parentNode)}));D.appendChild(z("rfe_moveup",RuoteFluoEditor.TEXTS.moveup_expression,function(){RuoteFluoEditor.moveExpression(E.parentNode,-1);D.style.opacity=B}));D.appendChild(z("rfe_movedown",RuoteFluoEditor.TEXTS.movedown_expression,function(){RuoteFluoEditor.moveExpression(E.parentNode,+1);D.style.opacity=B}));D.appendChild(z("rfe_paste",RuoteFluoEditor.TEXTS.paste_expression,function(){var F=document._rfe_clipboard;if(F){RuoteFluoEditor.insertExpression(E.parentNode,F)}}))}E.appendChild(D)}return{render:function(D,E){D=u(D);var M=E[0];var K="";if((typeof E[2][0])==="string"){K=E[2].shift()}var G=John.sfy(E[1]);var H=document.createElement("div");H.setAttribute("class","rfe_exp");D.appendChild(H);var C=document.createElement("span");C.setAttribute("class","rfe_exp_span rfe_expression_name");C.appendChild(document.createTextNode(M));H.appendChild(C);var I=document.createElement("span");I.setAttribute("class","rfe_exp_span rfe_expression_atts");I.appendChild(document.createTextNode(" "+G));H.appendChild(I);A(H);var J=function(){var O=H.parentNode;var N=O.parentNode;var P=b.parse(this.value);if(P){O.replaceChild(b.render(O,P),H);g(O)}else{N.removeChild(O);g(N)}};var B=function(N){var O=N||window.event;var P=O.charCode||O.keyCode;if(P===13){this.blur()}return false};var F=function(N){var O=N||window.event;var P=O.charCode||O.keyCode;return(P!=13)};var L=function(){H.removeChild(C);var N=document.createElement("input");N.setAttribute("type","text");N.value=M+" "+G;if(K!=""){N.value=M+" "+K+" "+G}H.replaceChild(N,I);N.onblur=J;N.onkeyup=B;N.onkeypress=F;N.focus()};C.onclick=L;I.onclick=L;return H},parse:function(C){var B=C.match(/^(\S+)(.*)$/);if((!B)||B[1].match(/^-+$/)){return null}return[B[1],John.parse("{"+B[2]+"}"),[]]},toExp:function(C){C=C.firstChild;var B=C.childNodes[0].firstChild.nodeValue;var D=C.childNodes[1].firstChild.nodeValue;return[B,John.parse("{"+D+"}"),[]]}}}();function q(z){return JSON.stringify(z)}function t(z){return q(l(z))}function a(A,z){var D="";for(var C=0;C<z;C++){D=D+"  "}D=D+A[0];var E=John.sfy(A[1]);if(E!==""){D=D+" "+E}for(var C=0,B=A[2].length;C<B;C++){D=D+"\n"+a(A[2][C],z+1)}return D}function y(z){return a(l(z),0)}function h(A,z){var D="";var E="";for(var C=0;C<z;C++){E=E+"  "}D=D+E+A[0];var F=John.sfy(A[1],{ruby:true});if(F!==""){D=D+" "+F}if(A[2].length>0){D=D+" do";for(var C=0,B=A[2].length;C<B;C++){D=D+"\n"+h(A[2][C],z+1)}D=D+"\n"+E+"end"}return D}function j(z){return h(l(z),0)}function o(z){var C=document.createElement(z[0]);for(k in z[1]){C.setAttribute(k,z[1][k])}for(var B=0,A=z[2].length;B<A;B++){C.appendChild(o(z[2][B]))}return C}function i(z){return(new XMLSerializer()).serializeToString(o(l(z)))}function m(A,B){var z=document.createElement("div");z.className="rfe_text";if(B[2].length>0){z.appendChild(document.createTextNode("end"))}A.appendChild(z)}function r(A,C){A=u(A);var z=A.lastChild;var B=v(A,C);A.replaceChild(B,z);A.appendChild(z);if(z.childNodes.length===0){z.appendChild(document.createTextNode("end"))}g(A)}function d(z){z=u(z);var A=z.parentNode;A.removeChild(z);if(A.childNodes.length===2){A.lastChild.removeChild(A.lastChild.firstChild)}document._rfe_clipboard=l(z);g(A)}function v(z,D,A){var C=document.createElement("div");C.className="rfe_expression";if(!A){C.setAttribute("style","margin-left: 14px;")}z.appendChild(C);if(!(D instanceof Array)){renderExpressionString(C,D.toString());return}b.render(C,D);for(var B=0;B<D[2].length;B++){v(C,D[2][B])}m(C,D);return C}function x(z,A){z=u(z);$(z).addClass("rfe_root");while(z.firstChild){z.removeChild(z.firstChild)}v(z,A,true);z.stack=[];z.currentTree=A}function n(z,B){z=u(z);var A=z.parentNode;if(B===-1){if(z.previousSibling.className!="rfe_expression"){return}A.insertBefore(z,z.previousSibling)}else{if(z.nextSibling.className!="rfe_expression"){return}A.insertBefore(z,z.nextSibling.nextSibling)}RuoteFluoEditor.triggerChange(A)}function e(A,B){A=u(A);var z=v(A.parentNode,B);A.parentNode.insertBefore(z,A);RuoteFluoEditor.triggerChange(A.parentNode)}function g(B){var A=f(B);var z=l(A);c(A,z);if(A.onChange){A.onChange(z)}}function c(A,z){A.stack.push(A.currentTree);A.currentTree=z}function w(A){A=u(A);if(A.stack.length<1){return}while(A.firstChild!=null){A.removeChild(A.firstChild)}var z=A.stack.pop();A.currentTree=z;v(A,z,true);if(A.onChange){A.onChange(z)}}function f(z){z=u(z);if($(z).hasClass("rfe_root")){return z}return f(z.parentNode)}function s(D,G,C){if(!G){G=f(D);C=""}if(G===D){return C.substring(1,C.length)}var A=G.childNodes;var B=-1;for(var z=0;z<A.length;z++){var F=A[z];if(F.nodeType!=1){continue}if(F.className!="rfe_expression"){continue}B+=1;var E=s(D,F,C+"_"+B);if(E!=null){return E}}return null}function l(A){var z=$(u(A));z.focus();if(!z.hasClass("rfe_expression")){z=z.children(".rfe_expression").first()}var B=b.toExp(z[0]);z.children(".rfe_expression").each(function(C,D){B[2].push(l(D))});return B}function u(z){if(z.jquery){return z[0]}if((typeof z)!=="string"){return z}if(z.match(/[\.#\[]/)){return $(z)[0]}return document.getElementById(z)}return{TEXTS:p,ExpressionHead:b,render:x,addExpression:r,removeExpression:d,moveExpression:n,insertExpression:e,triggerChange:g,undo:w,asJson:t,asRadial:y,asRuby:j,asXml:i}}();var FluoEditor=RuoteFluoEditor;$.fn.computedStyle=function(){var f=this.get(0);var b;var h={};if(window.getComputedStyle){var d=function(l,i){return i.toUpperCase()};b=window.getComputedStyle(f,null);for(var g=0,e=b.length;g<e;g++){var a=b[g];var j=a.replace(/\-([a-z])/g,d);var c=b.getPropertyValue(a);h[j]=c}return h}if(b=f.currentStyle){for(var a in b){h[a]=b[a]}return h}if(b=f.style){for(var a in b){if(typeof b[a]!="function"){h[a]=b[a]}}return h}return h};var RuoteFluo=(function(){var s="2.3.1";var j=7;var a=4;var l=this;function c(B){var y=["defs",[]];y[1].push(["marker",{id:"arrowhead",viewBox:"0 0 100 100",refX:"90",refY:"50",markerUnits:"strokeWidth",markerWidth:"10",markerHeight:"10",orient:"auto"},[["path",{"class":"fluo",d:"M 0 0 L 100 50 L 0 100 Z"}]]]);var C=["g",{id:"timer"},[["circle",{"class":"fluo",cx:"14",cy:"14",r:"14",fill:"none",stroke:"black","stroke-width":"1"}],["circle",{"class":"fluo",cx:"14",cy:"14",r:"10",fill:"none",stroke:"black","stroke-width":"1"}],["path",{id:"tt","class":"fluo",d:"M 14 05 L 14 07",fill:"none",stroke:"black","stroke-width":"1"}],]];for(var A=0;A<12;A++){var z=(A+1)*30;C[2].push(["use",{"xlink:href":"#tt",transform:"rotate("+z+", 14, 14)"}])}C[2].push(["path",{"class":"fluo",d:"M 14 10 L 14 14",fill:"none",stroke:"black","stroke-width":"1",transform:"rotate(120, 14, 14)"}]);C[2].push(["path",{"class":"fluo",d:"M 14 08 L 14 14",fill:"none",stroke:"black","stroke-width":"1"}]);y[1].push(C);f(B,y)}function q(E,C,y,D,B){C=C||"svg";y=y||{};B=B||{};var z=document.createElementNS("http://www.w3.org/2000/svg",C);Nu.each(y,function(H,G){var I=null;var F=H.match(/^([a-z]+):([a-z-]+)$/);if(F){I=F[1]}if(I==="xlink"){I="http://www.w3.org/1999/xlink"}if(G instanceof Array){G=G.join(" ")}z.setAttributeNS(I,H,G)});var A=$(z);if(D){A.append(document.createTextNode(D))}E[B.prepend?"prepend":"append"](A);if(C==="svg"){c(A)}return A}function f(D,y){var A=y[0];var z=y[1];var B=y[2]||[];if(z instanceof Array){B=z;z={}}var C=q(D,A,z);Nu.each(B,function(E){f(C,E)});return C}function n(C,A,y,B,z){if(A instanceof Array){return f(C,A)}else{return q(C,A,y,B,z)}}function o(y){if(y.width()===0){return g(y).width}else{return y.width()}}function m(y){if(y.height()===0){return g(y).height}else{return y.height()}}function t(y){return Nu.max(Nu.map(y.children(),function(z){return o($(z))}))}function v(y){return Nu.reduce(Nu.map(y.children(),function(z){return m($(z))}),0,function(A,z){return A+z})}function u(B,A){var z=n(B,"g");var C=0;Nu.each(A,function(D){var y=D;var F="";if(D instanceof Array){F=D[0];y=D[1]}var E=n(z,"text",{"class":$.trim("fluo "+F),x:0},y);C=C+m(E);E.attr("y",C)});z._width=t(z);z._height=v(z);return z}function w(z){var y=Nu.inject(z,0,function(A,B){return Nu.max([A,B._width,B._center||0])});Nu.each(z,function(B){var A=(y-B._width)/2;var C=B._center;if(C){A=(y-C)/2}i(B,A,0)})}function x(z){var y=(z.attr("transform")||"").match(/^translate\((\d+(?:\.\d+)?), (\d+(?:\.\d+)?)\)$/);if(!y){return{x:0,y:0}}return{x:parseFloat(y[1]),y:parseFloat(y[2])}}function g(y){var A=y[0].getBBox();var z=x(y);return{x:z.x,y:z.y,width:A.width,height:A.height}}function i(A,z,C){var B=x(A);A.attr("transform","translate("+(B.x+z)+", "+(B.y+C)+")")}function e(F,z,y,D,C,B){var E=null;var A=a;if(!B.bottom){E=["M",z,y,"L",D+(D>z?-1:1)*A,y,"Q",D,y,D,y+A,"L",D,C];if(B.inner){E=["M"].concat(E.slice(4))}}else{E=["M",z,y,"L",z,C-A,"Q",z,C,z+(D>z?1:-1)*A,C,"L",D,C];if(B.inner){E=E.slice(0,11)}}return n(F,"path",{"class":"fluo rounded_path",d:E,fill:"none"})}function b(y){var z=Nu.find(y[1],function(C,B){return(B===null)});if(z){z=z[0]}var A=Nu.select(y[1],function(C,B){return(B!=null)});return[z,A]}function p(K,E,z,C,y){y=y||{};var A=n(K,"g",{"class":"fluo card"});var H=(y.noCard||y.noRect)?null:n(A,"rect",{"class":"fluo"});var M=null;if(y.noCard){M={_height:0,_width:0}}else{var L=b(z);var B=[["expname",z[0]+(L[0]?" "+L[0]:"")]];Nu.each(L[1],function(O,N){B.push(O+": "+N)});M=u(A,B);i(M,a,0)}var I=M._width;if(!y.noCard){I=I+2*a}var D=n(A,"g",{"class":"fluo card_body"});i(D,I,0);var G=C(D);var J=G[0];var F=G[1];A._width=I+J+(H?a:0);A._height=Nu.max([M._height,F]);if(!y["short"]&&!y.noCard){A._height=A._height+2*a}if(H){H.attr("rx",j);H.attr("ry",j);H.attr("width",""+A._width);H.attr("height",""+A._height)}if(y.rightCentered){A._center=(A._width-J/2-a)*2}A._body=D;return A}var h={};h.text=function(A,z,y){var C=JSON.stringify(y[1]).slice(1,-1);var B=n(A,"text",{"class":"fluo text_exp"},$.trim(y[0]+" "+C));B._width=o(B);B._height=m(B)+a;B.attr("y",m(B));return B};h.any=function(A,z,y){return p(A,z,y,function(E){var C=0;var D=a;var B=0;Nu.each(y[2],function(G){var F=d(E,z+"_"+C,G);i(F,0,D);C=C+1;D=D+F._height+a;B=Nu.max([B,F._width])});return[B,D]})};h.sequence=function(B,z,y){var A=Nu.isEmpty(y[1]);return p(B,z,y,function(G){var E=0;var F=A?0:a;var C=0;var D=Nu.map(y[2],function(J){var H=d(G,z+"_"+E,J);i(H,0,F);E=E+1;F=F+H._height;C=Nu.max([C,H._width]);if(E>=y[2].length){return H}var I=n(G,"path",{"class":"fluo",d:"M 0 0 L 0 11","marker-end":"url(#arrowhead)"});i(I,0,F);F=F+11;I._width=o(I);I._height=m(I);return[H,I]});w(Nu.flatten(D));return[C,F]},{noCard:A})};h.concurrence=function(C,A,y){var E=p(C,A,y,function(I){var G=0;var F=0;var H=Nu.map(y[2],function(K){var J=d(I,A+"_"+G,K);i(J,F,a);F=F+J._width+a;G=G+1;return J._height});return[F-a,Nu.max(H)]},{noRect:true,rightCentered:true});var D=o(E._body);var z=0;var B=E._body.children().length;Nu.each(E._body.children(),function(J){z=z+1;var I=$(J);var G=o(I);var H=m(I);var F=x(I).x;e(E._body,D/2-a,0,F+G/2,a,{bottom:false,inner:z>1&&z<B});e(E._body,F+G/2,H+a,D/2-a,E._height,{bottom:true,inner:z>1&&z<B})});return E};h.wait=function(A,z,y){return p(A,z,y,function(B){var C=n(B,"use",{"xlink:href":"#timer"});return[2*a+o(C),m(C)]},{noRect:true,"short":true,rightCentered:true})};h.sleep=h.wait;Nu.each(["set","rset","unset","rewind","continue","back","break","stop","cancel","skip","jump"],function(y){h[y]=h.text});function d(B,A,z){var y=(h[z[0]]||h.any).call(l,B,A,z);y[0].id="exp_"+A;return y}function r(y){if(y.jquery){return y}if((typeof y)!=="string"){return $(y)}if(y.match(/[\.#\[]/)){return $(y)}return $("#"+y)}this.render=function(z,A,y){y=y||{};$div=r(z);$div.empty();$div[0].ruote_fluo_options=y;$div[0].ruote_fluo_definition=A;$g=d(n($div),"0",A);if(y.noOuterBorder){$g.children("rect").remove()}var H=$g._width+3;var E=$g._height+3;var F=H;var C=E;var B=y.width||y.w;var G=y.height||y.h;if(y.fit){F=$div.innerWidth()-8;C=$div.innerHeight()-8}else{if(B){F=B;C=G}}if(y.fit==="down"&&H<F){F=H;C=E}if(F<0||C<0){F=20;C=20}var D=y.preserveAspectRatio||y.par||"xMidYMin meet";$svg=$g.parent();$svg.attr("class",("ruote_fluo "+($svg.attr("class")||"")).trim());$svg[0].setAttributeNS(null,"viewBox","0 0 "+H+" "+E);$svg[0].setAttributeNS(null,"preserveAspectRatio",D);$svg.attr("width",""+F+"px");$svg.attr("height",""+C+"px");$svg.attr("data-ruote-fluo-scale",""+(F/H));return $g};this.highlight=function(E,C){var A=r(E);$("#"+A[0].id+" rect.fluo_highlight").remove();var B=$("#exp_"+C);if(B.length<1){return}var z=g(B);var y=n(B.parent(),"rect",{"class":"fluo_highlight"},null,{prepend:true});var D=parseFloat(y.computedStyle()["stroke-width"]||"3")+1;y.attr({x:z.x-D,y:z.y-D,width:z.width+2*D,height:z.height+2*D,rx:D,ry:D})};this.pin=function(y,B,G,z){G="fluo_pin fluo_pin_"+G;z=z||"wi";var I=r(y);var A=$("#exp_"+B);if(A.length<1){return}var J=g(A);var K=20;var D=10;var E=40;var H=15;var L=n(A.parent(),"g");var F=n(L,"path",{d:["M",0,H,"L",D,E,"L",K,H,"Q",D,0,0,H],"class":G});var C=n(L,"text",{"class":G,x:K/4,y:E/2},z);w([F,C]);i(L,J.x+J.width-18,J.y-20)};this.computeHeight=function(E,B){var z=r(E);var D=z.children("svg")[0].attributes.viewBox.value.split(" ");var y=parseInt(D[2],10);var A=parseInt(D[3],10);var C=y/B;return Math.round(A/C)};return this}).apply({});var Fluo=RuoteFluo;
/* compressed from commit f4fab37 */
